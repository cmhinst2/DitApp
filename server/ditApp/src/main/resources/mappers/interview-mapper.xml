<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.dit.app.ai.model.mapper.InterviewMapper">
	
	<!-- 새 인터뷰 세션 저장 -->
	<insert id="insertInterviewSession">
		INSERT INTO "INTERVIEW_SESSIONS"
		VALUES(#{sessionId}, #{position}, #{status}, DEFAULT, #{memberNo})
	</insert>
	
	<!-- 인터뷰 메시지 삽입 -->
	<insert id="insertInteviewMessage">
		INSERT INTO "INTERVIEW_MESSAGES"
		VALUES(SEQ_MSG_NO.NEXTVAL, #{sessionId}, #{role}, #{content}, DEFAULT)
	</insert>
	
	<!-- sessionId로 이전 메시지 목록 조회 -->
	<select id="selectAllMessageBySessionId">
		SELECT MESSAGE_ID, I_MSG.SESSION_ID, ROLE, CONTENT
		FROM "INTERVIEW_MESSAGES" I_MSG
		JOIN "INTERVIEW_SESSIONS" I_SES
		ON I_MSG.SESSION_ID = I_SES.SESSION_ID
		WHERE I_MSG.SESSION_ID = #{sessionId}
		AND I_SES.STATUS = 'N'
		ORDER BY MESSAGE_ID
	</select>
	
	<!-- session status값 변경(종료) -->
	<update id="completeInterviewSession">
		UPDATE "INTERVIEW_SESSIONS" SET
		STATUS = 'Y'
		WHERE SESSION_ID = #{memberSessionId}
	</update>

</mapper>
